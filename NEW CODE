# DECISION ANALYSIS FOR TAKING OR NOT TAKING FLU VACCINES

set.seed(123)
# data from CDC of vaccine effectiveness 
data_VE <-(0.01)*c(56,	60,	47,	49,	52,	19,	48,	40,	38,	29,	39,	36,	30,	44,	56)
#let us estimate the average vaccine effectiveness percentage
averageVE<-mean(data_VE)
varianceVE<-var(data_VE)
medianVE<-median(data_VE)

cat("Estimated average VE is", round(averageVE,3),"\n")

sim_num <- 10000
#estimate average cost of vaccine
data_price<-runif(sim_num,20,100)
common_price<-round(mean(data_price),2)
cat("Estimated price of Vaccine is", common_price,"\n")
# let's do flu probability which is between %5 and %20
sim_prob<-runif(sim_num,0.05,0.2)
common_prob<-median(sim_prob)
cat("Estimated probability of getting flu", common_prob,"\n")
# Inputs
admin_cost<-21.93           
cost_vaccine <- common_price + admin_cost         
cost_if_flu <- 273 #average treatment cost if get flu   
popdata_v<-c()
popdata_nov<-c()
for(v in data_VE){
vac_eff<-v
for(p in sim_prob){
  infection_rate_v <- p *(1-vac_eff) #infection rate for vaccinated people
  infection_rate_without_v <- p # infection rate of nonvaccinated people
  got_flu_vax <- rbinom(sim_num,1, infection_rate_v) #population of people who have vaccine and did or did not get flu
  cost_v <- got_flu_vax * cost_if_flu + cost_vaccine # set of cost per person
  
  ##  Don't take the vaccine scenario
  got_flu_novax <- rbinom(sim_num,1, infection_rate_without_v) #population of people who don't have vaccine and did or did not get flu
  cost_no_v <- got_flu_novax * cost_if_flu  # set of treatment cost for each person
 
  c(popdata_v,cost_v)
  c(popdata_nov,cost_nov)}}

mean_cost_vax <- mean(popdata_v)
mean_cost_novax<-mean(popdata_nov)

cat("Mean cost of the population WITH vaccine:    $", round(mean_cost_vax, 2), "\n")
cat("Mean cost of the population WITHOUT vaccine: $", round(mean_cost_novax, 2), "\n")
if(round(mean_cost_vax, 2)>round(mean_cost_novax, 2)){print("Not Taking Vaccine is best option")}else{print(
  "Taking Vaccine is best option")}
