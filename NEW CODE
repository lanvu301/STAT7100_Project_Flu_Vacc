# DECISION ANALYSIS FOR TAKING OR NOT TAKING FLU VACCINES

set.seed(123)
# data set from CDC of vaccine effectiveness over the years
data_VE <-(0.01)*c(56,	60,	47,	49,	52,	19,	48,	40,	38,	29,	39,	36,	30,	44,	56)
#let us estimate the average vaccine effectiveness percentage
averageVE<-mean(data_VE)
cat("Estimated average VE is", round(averageVE,3),"\n")
#estimate average cost of vaccine
data_VP <-c(19.483,20.878,20.49,
            20.49,32.448,21.595,19.962,25.44) # prices of vaccine for infants and young adults
cat("Interval of price of Vaccine is $", round(min(data_VP),2),"to $",round(max(data_VP),2),"\n")
##(The mean infection rate is 0.066 while the proportion for high risk of serious complication is 0.149.
#The mean probability of outpatient visits for flu infection is 0.313 for non-high risk while 0.625 for high risk.
#The mean probability of hospitalization for flu infection is 0.0042.
#The mean probability of death by flu infection is 0.00009.
#For costs of flu treatments:
#The mean cost is $3 for cases not medically attended.
#For outpatient visits, the mean cost is $125 for non-high risk and $725 for high risk.
#For hospitalization, the mean cost is $19,012 for non-high risk and $47,722 for high risk.
#Medical cost per death is $76,336.
#Mean value of lost life is estimated $6,882,779.)
mean_infectionrate<-0.066
mean_prob_highrisk<-0.149
mean_percent_outpatientvisit<-(0.149)*0.625 + (1-0.149)*0.313
mean_perecnt_hospital<- 0.0042
mean_percent_death<-0.00009
mean_percent_nonmed<-(1-mean_percent_outpatientvisit-mean_perecnt_hospital-mean_percent_death)

#Based on data, we shall assume the current costs for flu treatments is doubled
mean_cost_nonmed<-3*2
mean_cost_outpatientvisit<-(1-0.149)*125+(0.149)*725
mean_cost_hospital<-(1-0.149)*19012+(0.149)*47722
mean_cost_death<-76336+6882779
#For each cost we shall apply them into intervals by adding and subtracting %20
cat("For cases not medically attended, cost interval is",,"-",,"\n)
cat("For outpatient visits, cost interval is",,"-",,"\n)
cat("For hospitalization, cost interval is",,"-",,"\n)
cat("For death cases, cost interval is",,"-",,"\n)

#we shall use monte carlo simulation to generate these random variables and establish the benefits 

sim_num <- 1000 #number of simulations
popcostdata_v<-c()
popcostdata_nov<-c()
popvaccostdata<-c()
popbenefitdata<-c()
popnet_benefitdata<-c()

repeat{
vacc_eff<-sample(data_VE,1,replace=TRUE) #random pick from the list of vaccine efficacy
flu_infection_rate<-runif(1,0.068,0.108) # random pick from range of infection rate
sim_vaccost<-round(runif(1,round(min(data_VP),2),round(min(data_VP),2)),2)# random pick from range of vaccine price
admin_cost<-round(runif(1,25,40),2) # administration fee for flu shot
cost_no_med<-round(runif(1,2,100),2) # random pick from range of no medical treatment cost
cost_appointment<-round(runif(1,100,300),2)# random pick from range of appointment cost
cost_hospital<-round(runif(1,300,500),2)# random pick from range of hospitalization cost
cost_death<-round(runif(1,800000,1500000),2) # price of death
average_treatment_cost<-(0.3)*cost_no_med +(0.6)*cost_appointment+(0.1)*cost_hospital+(0.01)*cost_death
cost_with_vax<-flu_infection_rate*average_treatment_cost*(1-vacc_eff)# average cost of traetment if vaccinated
cost_without_vax<-flu_infection_rate*average_treatment_cost # average cost of traetment if not vaccinated
benefit<-(cost_without_vax - cost_with_vax)
flu_shot_cost<-sim_vaccost + admin_cost
net_benefit<-benefit-flu_shot_cost
popcostdata_v<-append(popcostdata_v,cost_with_vax)
popcostdata_nov<-append(popcostdata_nov,cost_without_vax)
popvaccostdata<-append(popvaccostdata,flu_shot_cost)
popbenefitdata<-append(popbenefitdata,benefit)
popnet_benefitdata<-append(popnet_benefitdata,net_benefit)
if(length(popnet_benefitdata)==sim_num){break}
}

par(mfrow=c(2,2))
# Plot cost distribution for both vaccine or non-vaccine
hist(popcostdata_nov, breaks=30, col="red",
     xlim=c(0, max(c(cost_novax, cost_vax))), xlab="Vaccine Cost",
     main="Cost Distribution: With vs Without Vaccine")
boxplot(popcostdata_nov, main = "No Vaccine", col = "lightblue", ylab = "Costs")
boxplot(popcostdata_v, main = "With Vaccine", col = "lightgreen", ylab = "Costs")
qqnorm(popnet_benefitdata,main="Q-Q Plot for Net Benefit Costs of Taking and Not Taking Vaccine")
qqline(popnet_benefitdata,col="red",lwd=2)
# Density plot 
grid()
